<!DOCTYPE html>
<html lang='zh'>
        <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="//cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
    <title>print queue on ebs</title>
</head>

<body>
        <div id="header">
    <nav class="navbar navbar-default" role="navigation">
                <div class="container-fluid">
                        <div class="navbar-header">
                                <a class="navbar-brand" href="/">CLOUD</a>
                        </div>
                        <div class="collapse navbar-collapse" id="example-navbar-collapse">
                                <ul class="nav navbar-nav">
                                        <li><a href="/tweet"><i class="icon-retweet icon-white"></i>Tweets</a></li>
                                        <li><a href="/archive.html"><i class="icon-book icon-white"></i>Archives</a></li>
                                        <li><a href="/category.html"><i class="icon-th-list icon-white"></i>category</a></li>
                                        <li><a href="/about.html"><i class="icon-user icon-white"></i>About</a></li>
                                        <li class="dropdown">
                                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                                        Friend Links <b class="caret"></b>
                                                </a>
                                                <ul class="dropdown-menu">
                                                        <li><a href="http://www.ruanyifeng.com/home.html" target="_blank">阮一峰</a></li>
                                                        <li><a href="http://coolshell.cn/" target="_blank">陈皓haoel</a></li>
                                                        <li><a href="http://www.dbanotes.net/" target="_blank">冯大辉Fenng</a></li>
                                                        <li><a href="http://robbin.iteye.com/" target="_blank">范凯robbin</a></li>
                                                        <li><a href="http://www.eygle.com/" target="_blank">盖国强eygle</a></li>
                                                        <li><a href="http://blog.csdn.net/tianlesoftware" target="_blank">David Dai</a></li>
                                                        <li><a href="http://www.joelonsoftware.com/" target="_blank">Joel Spolsky</a></li>
                                                        <li><a href="http://mindhacks.cn/" target="_blank">刘未鹏MindHacks</a></li>
                                                        <li><a href="http://www.my1510.cn/author.php?roseluqiu" target="_blank">闾丘露薇</a></li>
                                                        <li><a href="http://www.dapenti.com/blog/" target="_blank">铂程斋dapenti</a></li>
                                                </ul>
                                        </li>
                                </ul>
                        </div>
                </div>
        </nav>
</div>


        <div id="content">
                <div class="container">
                        <div class="row">
                                <div>
                                        <div class="entry">
        <div class="entry entry-detail">
                    <div class="entry-header">
                            <h1 class="entry-title">print queue on ebs</h1>
                            <div class="entry-meta">
                                    <span class="entry-by">
                                            <i class="icon-user"></i> <a href="/">dylan</a> on 2012-10-24 14:35:57
                                    </span>
                            </div>
                    </div>
                <div class="entry-content">
                        <h2>写在前面的话</h2>
<p>在ERP系统中，打印报表是不可或缺的应用之一。</p>
<p>由于Oracle本身的集成性，很多时候需要第三方工具的支持来一起完成某些任务，打印报表 即是其中一个的典型。</p>
<p>在Oracle EBS 11i以上版本中，一个典型的报表打印设置，就涉及到ERP应用中打印队列的 管理、ERP主机上打印队列的管理、打印服务器上Remote Print Manager打印队列的管理以 及远程打印机的管理。</p>
<p>Oracle ERP打印队列结构图</p>
<p><img alt="Oracle ERP" src="http://dylanninin.com/assets/images/2012/printer_of_erp.png" /></p>
<h2>打印服务器</h2>
<h3>1. Windows打印机管理</h3>
<p>在Windows中，有两种方式添加打印机：</p>
<ul>
<li>
<p>1）图形界面方式:在控制面板中，添加打印机和传真</p>
</li>
<li>
<p>2）命令行方式:C:\Windows\System32\prnmngr.vbs           </p>
</li>
</ul>
<p>当批量添加打印机时，使用图形界面的方式实在是一件体力活。如在做打印服务器迁移时， 将几台打印服务器上的远程打印机迁移到同一台打印服务器，此时使用向导界面则会非常耗 时，而且稍有不慎，就可能会勾选错误，导致打印机设置不正确；当然，出现问题也不好排 查。所幸的是，Windows也提供了vbs脚本来管理打印机。</p>
<h4>使用命令行管理打印机</h4>
<p>使用命令行管理打印机需要Windows操作系统中有<code>prnmngr.vbs</code>脚本，一般Windows XP， Windows Server 2003中会自带这些脚本，以下为简单的学习笔记。</p>
<pre><code>cscript prnmngr.vbs
cd  /D  C:\Windows\System32
cscript prnmngr.vbs
用法: prnmngr [-adxgtl?][c] [-s 服务器][-p 打印机][-m 驱动程序型号]
             [-r 端口][-u 用户名][-w 密码]

参数:
-a     - 添加本地打印机
-ac    - 添加打印机连接
-d     - 删除打印机
-g     - 获取默认打印机
-l     - 列出打印机
-m     - 驱动程序型号
-p     - 打印机名
-r     - 端口名
-s     - 服务器名
-t     - 设置默认打印机
-u     - 用户名
-w     - 密码
-x     - 删除所有打印机
-?     - 显示命令用法

例如:
prnmngr -a -p "打印机" -m "驱动程序" -r "lpt1:
prnmngr -d -p "打印机" -s 服务器
prnmngr -ac -p "\\服务器\打印机"
prnmngr -d -p "\\服务器\打印机"
prnmngr -x -s 服务器
prnmngr -l -s 服务器
prnmngr -g
prnmngr -t -p "\\服务器\打印机"
</code></pre>
<h5>主要用法</h5>
<p>添加本地打印机</p>
<pre><code>cscript prnmngr.vbs -a -p PrinterName [-s RemoteComputer] -m DriverName -r PortName  [-u UserName] [-w Password]
</code></pre>
<p>示例</p>
<pre><code>cscript prnmngr.vbs -a -p testptq_1 -m "Epson LQ-680Pro ESC/P 2"  -r LPT1:
</code></pre>
<p>删除打印机</p>
<p>删除指定打印机</p>
<pre><code>cscript prnmngr.vbs -d -p PrinterName [-s RemoteComputer] [-u UserName] [-w Password]
</code></pre>
<p>删除所有打印机，慎用！</p>
<pre><code>cscript prnmngr.vbs -x [-s RemoteComputer] [-u UserName] [-w Password]
</code></pre>
<p>设置默认打印机</p>
<p>显示默认打印机</p>
<pre><code>cscript prnmngr.vbs -g
</code></pre>
<p>设置默认打印机</p>
<pre><code>cscript prnmngr.vbs -t -p PrinterName
</code></pre>
<p>列出所有打印机</p>
<pre><code>cscript prnmngr.vbs -l [-s RemoteComputer] [-u UserName -w Password]
</code></pre>
<p>示例</p>
<pre><code>cscript prnmngr.vbs -l
</code></pre>
<p>添加远程打印机</p>
<p>先创建tcp/ip端口</p>
<pre><code>cscript prnport.vbs -a -r IP_192.168.1.111_1 -h 192.168.1.111 -o lpr -q testptq
</code></pre>
<p>再添加远程打印机</p>
<pre><code>cscript prnmngr.vbs -a -p testptq -m "Epson LQ-680Pro ESC/P 2" -r IP_192.168.1.111_1
</code></pre>
<p>打印机服务脚本</p>
<ul>
<li>prnmngr.vbs：添加或删除打印机</li>
<li>prncnfg.vbs：配置打印机</li>
<li>prndrvr.vbs：添加或删除打印机驱动程序</li>
<li>prnjobs.vbs：管理打印作业</li>
<li>prnqctl.vbs：管理打印测试页、暂停打印机、继续运行打印机或清除打印机队列</li>
<li>prnport.vbs：添加或删除打印机端口</li>
</ul>
<h3>2. RPM打印队列管理</h3>
<p>在Windows打印服务器管理打印队列，可以使用付费软件Remote Print Manager。用来接收 来自ERP服务器的打印请求，接收请求后，在RPM打印队列中进行一些格式的调整或转换，之 后，再将这些请求发送给远程打印机进行真正的打印作业。</p>
<p>目前主要接触过RPM Elite 4.5和RPM 5.1.1.99，新版本的功能更加强大，管理也方便。</p>
<h3>3. AIX打印队列管理</h3>
<h4>基本概念</h4>
<p>print job</p>
<ul>
<li>在打印机上运行的作业单元</li>
<li>一个打印任务可以打印单个或多个文件</li>
<li>每个打印任务由job id 唯一标识</li>
</ul>
<p>queue</p>
<ul>
<li>打印队列用来管理打印任务</li>
<li>配置：/etc/qconfig</li>
<li>队列名和队列设备</li>
</ul>
<p>queue device</p>
<ul>
<li>队列设备，可以是本地、远程等设备</li>
</ul>
<p>注：一个单独的打印队列可以与多个队列设备关联</p>
<p>Print spooler</p>
<ul>
<li>管理打印的通用系统</li>
</ul>
<h4>日常管理</h4>
<h5>create</h5>
<ul>
<li>命令:smit print</li>
</ul>
<h5>configure</h5>
<ul>
<li>
<p>/etc/qconfig</p>
</li>
<li>
<p>example:</p>
<p>testptq:
        device = @testptq
        up = TRUE
        host = testptq                                             <br />
        s_statfilter = /usr/lib/lpd/bsdshort
        l_statfilter = /usr/lib/lpd/bsdlong
        rq = testptq                                                           <br />
@testptq:
        backend = /usr/lib/lpd/rembak</p>
</li>
</ul>
<h5>control</h5>
<h6>lpstat</h6>
<p>lpstat：显示线性打印机的目前状态信息</p>
<pre><code>usage: lpstat [-drstW][-aDestination,...][-cClassname,...]
              [-oOutRequirement,...][-pPrinter,...][-uUser,...]
              [-vPrinter,...] [jobid,...]
        Prints LP status information.
</code></pre>
<p>qchk：显示某些打印任务、打印队列的目前状态信息</p>
<p>lpq：显示某些指定用户、任务号的打印任务的状态信息</p>
<p>lpr：使用打印系统打印文件</p>
<h6>stop</h6>
<pre><code>enq  -D -P 'testoffice:@testptq'  #D Down print queue
enq  -A -w Delay   #当打印队任务完成时每间隔多少秒更新打印状态信息
</code></pre>
<h6>start</h6>
<pre><code>lpstat -vxxoffice              #status
enq -U -P 'xxoffice:@testptq'  #start queue
qchk -P  xxoffice              #status
enabl    xxoffice:@testptq     #start queue
</code></pre>
<h6>flush</h6>
<pre><code>lpstat -vxxoffice
qcan -P xxoffice -x 3          #cancel job 3 on queue xxoffice
cancel       3                 #cancel job 3
lprm -P xxoffice 3             #cancel job 3 on queue xxoffice
enq -P xxoffice  -x 3          #cancel job 3 on queue xxoffice
</code></pre>
<p>example:</p>
<pre><code># lpstat -vxxoffice
Queue   Dev   Status    Job Files              User         PP %   Blks  Cp Rnk
------- ----- --------- --- ------------------ ---------- ---- -- ----- --- ---
xxoffic @xxof DOWN    
              QUEUED    505 STDIN.966664       testmgr                1   1   1
              QUEUED    506 STDIN.622782       testmgr                1   1   2
              QUEUED    507 STDIN.581720       testmgr                1   1   3
: (FATAL ERROR) 0781-233 Unknown host xxoffice.

# qcan -P xxoffice -x 505
: (FATAL ERROR) 0781-233 Unknown host xxoffice.

# lpstat -vxxoffice     
Queue   Dev   Status    Job Files              User         PP %   Blks  Cp Rnk
------- ----- --------- --- ------------------ ---------- ---- -- ----- --- ---
xxoffic @xxof DOWN

              QUEUED    506 STDIN.622782       testmgr                1   1   1

              QUEUED    507 STDIN.581720       testmgr                1   1   2

: (FATAL ERROR) 0781-233 Unknown host xxoffice.
# cancel 506
# lpstat -vxxoffice
Queue   Dev   Status    Job Files              User         PP %   Blks  Cp Rnk
------- ----- --------- --- ------------------ ---------- ---- -- ----- --- ---
xxoffic @xxof DOWN    
              QUEUED    507 STDIN.581720       testmgr                1   1   1
: (FATAL ERROR) 0781-233 Unknown host xxoffice.
</code></pre>
<h6>check</h6>
<ul>
<li>lpstat       </li>
<li>ps ef | grep qdaemon</li>
<li>make sure that system date is correct   #enq -Y to register qconfig file</li>
<li>make sure /tmp directory is not full</li>
<li>obsolete queue:/var/spool/lpd/qdir and remove from /etc/qconfig</li>
<li>hosts can be pinged </li>
</ul>
<h5>命令汇总</h5>
<p>Commands and equivalents</p>
<pre><code>Submit print jobs   Status print jobs    Cancel print jobs
enq                 enq -A               enq -x
qprt                qchk                 qcan
lp                  lpstat               lprm
lpr                 lpq                  cancel
</code></pre>
<h3>4. ERP打印队列的管理</h3>
<p>在ERP应用中打印队列的设置主要包括打印机驱动、样式、类型以及注册等四个方面，用户 在提交报表请求时选择所需要的打印机即可完成想要的打印作业。</p>
<p>其中，打印驱动设置是重点。</p>
<p>打印机的驱动，是ERP应用中打印请求抛向外部（操作系统、打印机等）的出口，可以使用 操作系统命令、程序或者子例程的方式实现。</p>
<p>本例中，直接使用操作系统的打印命令，如下：</p>
<p><img alt="printer_driver" src="http://dylanninin.com/assets/images/2012/checklp.png" /></p>
<p>直接调用操作系统的打印命令进行打印，其中arguments内容如下：</p>
<pre><code> /usr/bin/iconv -f UTF-8 -t GB18030 $PROFILES$.FILENAME | lpr -P$PROFILES$.PRINTER -#$PROFILES$.CONC_COPIES -T"$PROFILES$.TITLE"
</code></pre>
<p>配置好打印驱动之后，还需要设置好打印样式、打印类型；之后，就可以在ERP应用中注册 打印队列。</p>
<h3>5.CentOS打印队列管理</h3>
<p>Oracle ERP也是一个跨平台的应用，除了可以部署在Unix上，如IBM AIX，还可以部署在 Linux、Windows平台，如CentOS等。</p>
<p>在CentOS上，提供了与AIX系统上类似的lpstat、cancel等cups打印机管理工具，只要熟悉 了AIX上打印作业管理，在其他平台上上手十分容易。</p>
<p>CentOS中，也提供了两种打印机管理方式，图形界面和命令行。在使用过程中，若批量新 建打印队列，则可以先以图形向导设置一个打印队列，测试通过后，再直接编辑配置文件， 重启打印服务器即可。</p>
<p>CentOS中，打印机配置文件：<code>/etc/cups/printers.conf</code>。编辑后，重启cups服务。</p>
<h2>测试</h2>
<p>从Oracle ERP打印机设置中可以看出，在实际使用过程中，打印请求会首先从ERP应用中运 行完毕后以打印命令的方式抛向ERP服务器；然后，ERP服务器通过CUPS/lpd服务或协议将请 求发送给远程打印服务器，这里为RPM打印管理服务器；在RPM打印管理服务器上，又会进行 一些格式的调整或转换，最后才将请求抛给远程打印机进行真正的打印作业。</p>
<p>一个打印作业经过ERP应用、ERP服务器、RPM服务器、打印机最后才能真正变成手上拿着的 报表或者单据。若其中任何一个环节出现问题，打印作业则有可能出现异常，因此快速的排 查解决问题十分重要。这里提供一个思路，类似于单元测试、集成测试的概念，自底向上， 从依赖性最小的环节开始测试，确保没有问题，再测试依赖此服务的其他环节，直到最后能 够形成一套完整、可用的打印服务。</p>
<p>在此例中，测试可能需要经过以下步骤：</p>
<h3>1. Windows上打印机管理</h3>
<p>新建TCP/IP端口，并创建远程打印机后，打印测试页，进行测试。</p>
<p>注：在测试前，确保远程打印机可以ping通。</p>
<h3>2. RPM上打印队列管理</h3>
<p>目前暂未找到直接测试RPM上打印队列的方法</p>
<h3>3. AIX上打印队列管理</h3>
<p>使用命令行测试</p>
<p>在ERP应用中，注册的打印队列使用命令行方式向ERP服务器抛送打印请求，这里可以直接在 OS上进行测试。</p>
<pre><code>[root@erpprod]# iconv -f UTF-8 -t GB18030 erp_printer.txt | lpr -Ptestptq -#1 -T"打印测试Oracle ERP"
</code></pre>
<p>然后，使用<code>lpstat</code>查看OS上打印作业状态，查看RPM上打印作业计数等</p>
<p>注：在测试前，确保打印服务器可以ping通，打印队列和打印服务已经启动；</p>
<p>打印时，可以打印中英文，测试下是否有乱码发生。</p>
<h3>4. ERP上打印队列管理</h3>
<p>设置好打印驱动、打印队列后，提交打印请求，更改打印选项，选择测试的打印机，提交请 求，查看打印效果。</p>
<h2>脚本</h2>
<p>在实际应用中，由于远程打印机、网络、断电重启等原因，时常会出现ERP服务器上打印队 列down掉的情况，这时需要手动检查远程打印机的网络是否正常，并重启打印队列。</p>
<p>对于日常维护来说，这会是一件例行事务，若用户要求打印业务需在上班时正常运行，则必 须把检查打印队列作为上班时的第一项任务，这样无疑也占用了宝贵的时间。</p>
<p>前面提到过AIX上一些打印队列管理的命令，因此可以编写简单的shell脚本，检查网络、打 印队列等，并尝试重启打印队列，再部署成定时任务，出现问题时发送邮件通知。这样可以 将时间留给其他更重要的工作。</p>
<h3>1.脚本示意图</h3>
<p><img alt="" src="http://dylanninin.com/blog/assets/themes/images/2012/checklp.png" /></p>
<h2>2.checklp.sh 检查队列</h2>
<pre><code>#!/bin/ksh
#abstract:
#check lpstat
#history:
#2012-09-04 dylanninin@gmail.com first release
#variables
script_basepath=/u1/PROD/prodora/itsection/sys/lpd
mail_date=$(date +%Y-%m-%d\ %H:%M:%S)
receipt=dylanninin@gmail.com
hostname=$(hostname)

#path
export PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin

#lpstat
lpstat_basepath=/var/spool/lpd/stat
lpstats=${lpstat_basepath}/s.*.@*

#check hosts
checklp_log=${script_basepath}/checklp.log
if [ -e ${checklp_log} ]; then
    true &gt; ${checklp_log}
else
    touch ${checklp_log}
fi

#check ping function
function check_ping {
    v_ping=$1
        if [ ${v_ping} == "" ]; then
            echo "!!!!!! hostname or ip could not be null or empty!" &gt;&gt; ${checklp_log} 2&gt;&amp;1
        else
            ping -c 1 -w 1 ${v_ping} &amp;&gt; /dev/null &amp;&amp; result=0 || result=1
            if [ "${result}" == 0 ]; then
                echo "&gt;&gt;&gt;&gt;&gt;&gt; Host ${v_ping} is Up!"
            else
                echo "!!!!!! Host ${v_ping} is Down!" &gt;&gt; ${checklp_log} 2&gt;&amp;1
            fi
        fi
    return
}

#host list of print queue
host_list=$(ls -l ${lpstats} | cut -d "@" -f 2 | sort | uniq )
for v_host in ${host_list}
do
     check_ping ${v_host}
done

office_ip=${script_basepath}/office.ip
if [ ! -e ${office_ip} ]; then
    echo "!!!!!! office ip file ${office_ip} does not exist!" &gt;&gt; ${checklp_log} 2&gt;&amp;1
    exit 0
fi

#check lpstat
lplist=$(ls -l ${lpstats} | awk -F "." '{print $2 ":" $3}')
office_log=${script_basepath}/office.log
for v_printer in ${lplist}
do
    v_queue=$(echo ${v_printer} | cut -d ":" -f 1)
    v_host=$(echo ${v_printer} | cut -d "@" -f 2)
    lpstat -W -v${v_queue} &gt; ${office_log} 2&gt;&amp;1
    v_down=$(grep "DOWN" ${office_log})
    v_error=$(grep "ERROR" ${office_log})
    if [ "${v_down}" != "" ]; then
        v_office=$(echo ${v_queue} | cut -d "-" -f 1)
        v_ip=$(grep ${v_office} ${officeip} | cut -d ":" -f 2)
        if [ "${v_ip}" != "" ]; then
            check_ping ${v_ip}
        fi
        echo "${v_down}" &gt;&gt; ${checklp_log} 2&gt;&amp;1
        #stop queue
        echo "&gt;&gt;&gt;&gt;&gt;&gt; enq -D -P${v_printer}"
        enq -D -P${v_printer} &gt; ${restart_log} 2&gt;&amp;1
        #startup queue
        echo "&gt;&gt;&gt;&gt;&gt;&gt; enq -U -P${v_printer} ..."
        enq -U -P${v_printer} &gt; ${restart_log} 2&gt;&amp;1
    elif [ "${v_error}" != "" ]; then
        echo "${v_error}" &gt;&gt; ${checklp_log} 2&gt;&amp;1
    fi
done
if [ -e ${office_log} ]; then
    true &gt; ${office_log}
fi

#mail
if [ $(cat ${checklp_log} | wc -l) -gt 0 ]; then
    cat ${checklp_log} | mail -s "${mail_date}:${hostname} dba daily check of lpstat" ${receipt} 
fi
</code></pre>
<h3>3.office.ip 办事处IP</h3>
<pre><code>xxoffice:192.168.1.111
xx1office: 192.168.2.111
xx2office: 192.168.3.111
... ...
xxnoffice: 192.168.255.111
</code></pre>
<h3>4.restartlp.sh 重启所有队列</h3>
<pre><code>#!/bin/ksh
#abstract:
#check lpstat
#history:
#2012-09-04     mis_ghb         first release
#2012-12-04     mis_ghb         restart all lpd queue
#variables
script_basepath=/u1/PROD/prodora/itsection/sys/lpd
mail_date=$(date +%Y-%m-%d\ %H:%M:%S)
receipt=dylanninin@gmail.com
hostname=$(hostname)

#path
export PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin

#lpstat
lpstat_basepath=/var/spool/lpd
lpstats=${lpstat_basepath}/stat/s.*.@*
lpd_qdir=${lpstat_basepath}/qdir

#check restartlp log file
restartlp_log=${script_basepath}/restartlp.log
if [ -e ${restartlp_log} ]; then
   true &gt; ${restartlp_log}
else
   touch ${restartlp_log}
fi

#check qdir
qdir_grep=$(ls ${lpd_qdir} | grep -v ".core")
if [ -e "${qdir_grep}" == "" ]; then
        ls -l ${lpd_qdir} &gt; ${restartlp_log}
fi

#check lpstat
lplist=$(ls -l ${lpstats} | awk -F "." '{print $2 ":" $3}')
for v_printer in ${lplist}
do
    #stop queue
    echo "&gt;&gt;&gt;&gt;&gt;&gt; enq -D -P${v_printer}"
    enq -D -P${v_printer} &gt;  ${restart_log} 2&gt;&amp;1
    #startup queue
    echo "&gt;&gt;&gt;&gt;&gt;&gt; enq -U -P${v_printer} ..."
    enq -U -P${v_printer} &gt;  ${restart_log} 2&gt;&amp;1
done

#mail
if [ $(cat ${restartlp_log} | wc -l) -gt 0 ]; then
   cat ${restartlp_log} | mail -s "${mail_date}:${hostname} dba daily check of lpstat" ${receipt} 
fi
</code></pre>
<h3>5.testlp.sh测试打印队列</h3>
<pre><code>#!/bin/ksh
#abstract:
#check lpstat
#history:
#2012-09-04     mis_ghb         first release
#variables
script_basepath=/u1/PROD/prodora/itsection/sys/lpd
content=${script_basepath}/printer_test.txt
current_date=$(date +%Y-%m-%d\ %H:%M:%S)

#path
export PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin

lpq=$1
if [ "${lpq}" == "" ]; then
    echo "print queue must be specified!"
elif [ ! -e ${content} ]; then
    echo "print content file ${content} does not exist!"
else
    echo "iconv -f UTF-8 -t GB18030 ${content} | lpr -P${lpq} -#1 -T'Print Queue Test on Oracle EBS at ${current_date}'"
    iconv -f UTF-8 -t GB18030 ${content} | lpr -P${lpq} -#1 -T'Print Queue Test on Oracle EBS at ${current_date}'
fi
</code></pre>
<h3>6. 其他</h3>
<p>以上脚本发送的邮件若出现中文乱码，可以使用iconv进行编码转换，如：</p>
<pre><code>if [ `cat ${sqllog} | wc -l` -gt 0 ]; then
   iconv -f UTF-8 -t GB18030 ${sqllog} | mail -s "${mail_date}:${hostname} dba daily check of ${script_name}" ${receipt} 
fi
</code></pre>
<h2>参考</h2>
<ul>
<li><a href="http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/prnmngr.mspx?mfr=true">Microsoft：prnmngr.vbs</a></li>
<li>IBM AIX Redbook：IBM @server p5 and pSeries Administration and Support for AIX 5L Version 5.3</li>
</ul> 
                </div>
        </div>
</div>

                                </div>
                        </div>
                </div>
        </div>
        <div id="footer">

        <div class="modal-footer">
                <p class="text-center">
                        Blog of <a href="/">dylan</a>.
                        Follow me on <a href="https://twitter.com/dylanninin" target="_blank">twitter</a>
                        or <a href="http://weibo.com/dylanninin" target="_blank">weibo</a>
                </p>
                <p class="text-center">
                        UI Designed by <a href="http://twitter.github.com/bootstrap" target="_blank">Twitter
                                Bootstrap</a>.
                        Powered by <a href="http://webpy.org" target="_blank">Web.py</a>.
                        Hosted by <a href="http://www.linode.com" target="_blank">Linode</a>.
                        Licensed under <a
                                href="http://creativecommons.org/licenses/by-nc-nd/3.0/" target="_blank">CC BY
                                3.0</a>
                </p>
                <p class="text-center">
                        Copyright &copy <a href="/">CLOUD</a> |
                        <a href="/about.html">About</a>
                </p>

        </div>
        <script src="/static/js/jquery.js"></script>
        <script src="/static/js/jquery-3.1.1.min.js"></script>
    <script src="/static/js/bootstrap.js"></script>
</div>

</body>
</html>
