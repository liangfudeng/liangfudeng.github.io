<!DOCTYPE html>
<html lang='zh'>
        <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="//cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
    <title>ora 00257</title>
</head>

<body>
        <div id="header">
    <nav class="navbar navbar-default" role="navigation">
                <div class="container-fluid">
                        <div class="navbar-header">
                                <a class="navbar-brand" href="/">CLOUD</a>
                        </div>
                        <div class="collapse navbar-collapse" id="example-navbar-collapse">
                                <ul class="nav navbar-nav">
                                        <li><a href="/tweet"><i class="icon-retweet icon-white"></i>Tweets</a></li>
                                        <li><a href="/archive.html"><i class="icon-book icon-white"></i>Archives</a></li>
                                        <li><a href="/category.html"><i class="icon-th-list icon-white"></i>category</a></li>
                                        <li><a href="/about.html"><i class="icon-user icon-white"></i>About</a></li>
                                        <li class="dropdown">
                                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                                        Friend Links <b class="caret"></b>
                                                </a>
                                                <ul class="dropdown-menu">
                                                        <li><a href="http://www.ruanyifeng.com/home.html" target="_blank">阮一峰</a></li>
                                                        <li><a href="http://coolshell.cn/" target="_blank">陈皓haoel</a></li>
                                                        <li><a href="http://www.dbanotes.net/" target="_blank">冯大辉Fenng</a></li>
                                                        <li><a href="http://robbin.iteye.com/" target="_blank">范凯robbin</a></li>
                                                        <li><a href="http://www.eygle.com/" target="_blank">盖国强eygle</a></li>
                                                        <li><a href="http://blog.csdn.net/tianlesoftware" target="_blank">David Dai</a></li>
                                                        <li><a href="http://www.joelonsoftware.com/" target="_blank">Joel Spolsky</a></li>
                                                        <li><a href="http://mindhacks.cn/" target="_blank">刘未鹏MindHacks</a></li>
                                                        <li><a href="http://www.my1510.cn/author.php?roseluqiu" target="_blank">闾丘露薇</a></li>
                                                        <li><a href="http://www.dapenti.com/blog/" target="_blank">铂程斋dapenti</a></li>
                                                </ul>
                                        </li>
                                </ul>
                        </div>
                </div>
        </nav>
</div>


        <div id="content">
                <div class="container">
                        <div class="row">
                                <div>
                                        <div class="entry">
        <div class="entry entry-detail">
                    <div class="entry-header">
                            <h1 class="entry-title">ora 00257</h1>
                            <div class="entry-meta">
                                    <span class="entry-by">
                                            <i class="icon-user"></i> <a href="/">dylan</a> on 2012-11-05 14:35:57
                                    </span>
                            </div>
                    </div>
                <div class="entry-content">
                        <h2>异常症状</h2>
<p>使用PL/SQL Developer连接Oracle数据库时，出现ORA-00257错误</p>
<pre><code>ORA-00257: archiver error. Connect internal only, until freed.
</code></pre>
<h2>Error Message</h2>
<p>ORA-00257: archiver error. Connect internal only, until freed.</p>
<p>Cause:  The archiver process received an error while trying to archive a redo log. If the problem is not resolved soon, the database will stop executing transactions.The most likely cause of this message is the destination device is out of space to store the redo log file.</p>
<p>Action:  Check archiver trace file for a detailed description of the problem. Also verify that the device specified in the initialization parameter ARCHIVE_LOG_DEST is set up properly for archiving.</p>
<p>ORA-00257，即存储重做日志的文件已经超出目标设备限制的大小</p>
<h2>异常确认</h2>
<p>登录到服务器主机，操作如下：</p>
<p>检查启动参数</p>
<pre><code>SQL&gt; show parameter spfile;
NAME         TYPE       VALUE
----------- ----------- --------------------------------------------------
spfile      string     /db/oracle/product/10.2.0/db_1/dbs/spfiledbtest.ora
</code></pre>
<p>查看dest_size参数</p>
<pre><code>SQL&gt; show parameter dest_size;
NAME                        TYPE       VALUE
-------------------------- ----------- ----------------------------

db_recovery_file_dest_size big integer 2G
</code></pre>
<p>查看dest路径</p>
<pre><code>SQL&gt; show parameter log_archive_dest;
NAME                              TYPE       VALUE
-------------------------------- ----------- ------------------------------
log_archive_dest                 string
log_archive_dest_1               string
log_archive_dest_10              string
log_archive_dest_2               string
log_archive_dest_3               string
log_archive_dest_4               string
log_archive_dest_5               string
log_archive_dest_6               string
log_archive_dest_7               string
log_archive_dest_8               string
log_archive_dest_9               string

NAME                            TYPE       VALUE
------------------------------- ---------- ------------------------------
log_archive_dest_state_1        string     enable
log_archive_dest_state_10       string     enable
log_archive_dest_state_2        string     enable
log_archive_dest_state_3        string     enable
log_archive_dest_state_4        string     enable
log_archive_dest_state_5        string     enable
log_archive_dest_state_6        string     enable
log_archive_dest_state_7        string     enable
log_archive_dest_state_8        string     enable
log_archive_dest_state_9        string     enable
</code></pre>
<p>若dest为空，表明log_archive使用的是默认值，此时则可以使用archive log list查看归 档路径和序列，如下</p>
<pre><code>SQL&gt; archive log list;
Database log mode               Archive Mode
Automatic archival              Enabled
Archive destination             USE_DB_RECOVERY_FILE_DEST
Oldest online log sequence      88
Next log sequence to archive    88
Current log sequence            90
</code></pre>
<p>4）查询恢复目录参数</p>
<pre><code>SQL&gt; show parameter recover;
NAME                              TYPE        VALUE
--------------------------------- ----------- ------------------------------
db_recovery_file_dest             string     /db/oracle/flash_recovery_area
db_recovery_file_dest_size        big integer 2G
recovery_parallelism              integer     0
</code></pre>
<p>5）查看恢复目录文件大小</p>
<pre><code>SQL&gt; host du -h --max-depth=1 /db/oracle/flash_recovery_area/DBTEST;
4.0K          /db/oracle/flash_recovery_area/DBTEST/onlinelog
2.0G          /db/oracle/flash_recovery_area/DBTEST/archivelog
2.0G          /db/oracle/flash_recovery_area/DBTEST
</code></pre>
<p>6）查看恢复目录使用率</p>
<pre><code>SQL&gt; select * from v$flash_recovery_area_usage;
FILE_TYPE    PERCENT_SPACE_USED PERCENT_SPACE_RECLAIMABLE NUMBER_OF_FILES
------------ ------------------ ------------------------- ---------------
CONTROLFILE                   0                         0               0
ONLINELOG                     0                         0               0
ARCHIVELOG                97.79                         0              44
BACKUPPIECE                   0                         0               0
IMAGECOPY                     0                         0               0
FLASHBACKLOG                  0                         0               0
6 rows selected.
</code></pre>
<p>flash_recovery的使用率达到97.79%，再有新的事务时，很可能会超出2G大小，故Oracle会 提示ORA-00257的错误。</p>
<h2>解决方案</h2>
<p>出现ORA-00257错误，解决办法有两个，一是调整db_recovery_file_dest_size的大小；二 是移除或者转移一些归档日志，释放空间。    </p>
<h3>解决方案1</h3>
<p>调整db_recovery_file_dest_size的大小</p>
<pre><code>SQL&gt; alter system set db_recovery_file_dest_size=3G scope=both;

System altered.
</code></pre>
<p>此时再尝试则可以正常连接；</p>
<h3>解决方案2</h3>
<p>移除或者转移归档日志，释放空间</p>
<p>删除过期的归档日志：</p>
<pre><code>find  /db/oracle/flash_recovery_area/DBTEST/archivelog -name "2012-*" -mtime +14 -exec rm {} \;
</code></pre>
<p>使用rman同步控制文件，释放空间</p>
<p>检查一些无用的archivelog</p>
<pre><code>RMAN&gt; crosscheck archivelog all;
</code></pre>
<p>删除过期的归档</p>
<pre><code>RMAN&gt; delete expired archivelog all;
</code></pre>
<p>注：在OS级别删除归档日志后，还需要使用rman检查、删除，否则即使删除了归档日志，但 Oracle数据库记录的使用空间依然没有释放。</p>
<p>另外，也可以直接使用rman删除归档日志</p>
<pre><code>RMAN&gt; delete noprompt archivelog all completed before 'sysdate - 14';
</code></pre>
<h2>参数设置</h2>
<p>Oracle数据库中归档日志对于数据库的恢复十分重要，以下仅列出跟此错误相关的几个参数， 其中<code>LOG_ARCHIVE_DEST_N/LOG_ARCHIVE_DEST_STATE_N</code>多涉及到重做日志的多路复用、 Data Guard等，这里暂不列出。</p>
<h3>1.LOG_ARCHIVE_DEST</h3>
<p>Parameter type: String</p>
<p>Syntax: <code>LOG_ARCHIVE_DEST = filespec</code></p>
<p>Default value: Null</p>
<p>Modifiable: <code>ALTER SYSTEM</code></p>
<p>Range of values: Any valid path or device name, except raw partitions</p>
<p>Basic: No</p>
<p>Real Application Cluster: Multiple instances can have different values.</p>
<p><code>LOG_ARCHIVE_DEST</code> is applicable only if you are running the database in ARCHIVELOG mode or are recovering a database from archived redo logs.  <code>LOG_ARCHIVE_DEST</code> is incompatible with the <code>LOG_ARCHIVE_DEST_n</code> parameters, a nd must be defined as the null string ("") or (' ') when any <code>LOG_ARCHIVE_DEST_n</code> parameter has a value other than a null string. Use a text string to specify the default location and root of the disk file or tape device when archiving redo log files. (Archiving to tape is not supported on all operating systems.) The value cannot be a raw partition.</p>
<p>If <code>LOG_ARCHIVE_DEST</code> is not explicitly defined and all the <code>LOG_ARCHIVE_DEST_n</code> parameters have null string values, <code>LOG_ARCHIVE_DEST</code> is set to an operating system-specific default value on instance startup.</p>
<p>To override the destination that this parameter specifies, either specify a different destination for manual archiving or use the <code>SQL*Plus</code> statement <code>ARCHIVE LOG START</code> filespec for automatic archiving, where filespec is the new archive destination. To permanently change the destination, use the statement <code>ALTER SYSTEM SET LOG_ARCHIVE_DEST = filespec</code>, where filespec is the new archive destination.</p>
<p>Neither <code>LOG_ARCHIVE_DEST</code> nor <code>LOG_ARCHIVE_FORMAT</code> have to be complete file or directory specifiers themselves; they only need to form a valid file path after the variables are substituted into <code>LOG_ARCHIVE_FORMAT</code> and the two parameters are concatenated together.</p>
<h3>2.DB_RECOVERY_FILE_DEST_SIZE</h3>
<p>Parameter type: Big integer</p>
<p>Syntax: <code>DB_RECOVERY_FILE_DEST_SIZE = integer [K | M | G]</code></p>
<p>Default value: There is no default value.</p>
<p>Modifiable: <code>ALTER SYSTEM ... SID='*'</code></p>
<p>Basic: Yes</p>
<p>Real Application Clusters: You must set this parameter for every instance, and multiple instances must have the same value </p>
<p><code>DB_RECOVERY_FILE_DEST_SIZE</code> specifies (in bytes) the hard limit on the total space to be used by target database recovery files created in the flash recovery area.</p>
<h3>3.DB_RECOVERY_FILE_DEST</h3>
<p>Parameter type: String</p>
<p>Syntax: <code>DB_RECOVERY_FILE_DEST = directory | disk group</code></p>
<p>Default value: There is no default value.</p>
<p>Modifiable: <code>ALTER SYSTEM ... SID='*'</code></p>
<p>Basic: Yes</p>
<p>Real Application Clusters: You must set this parameter for every instance, and multiple instances must have the same value.</p>
<p><code>DB_RECOVERY_FILE_DEST</code> specifies the default location for the flash recovery 
area.</p>
<p>The flash recovery area contains multiplexed copies of current control files and online redo logs, as well as archived redo logs, flashback logs, and RMAN backups.</p>
<p>Specifying this parameter without also specifying the <code>DB_RECOVERY_FILE_DEST_SIZE</code> parameter is not allowed.</p>
<h2>参考</h2>
<ul>
<li>Oracle Database Reference</li>
<li>Oracle Database Error Messages</li>
</ul> 
                </div>
        </div>
</div>

                                </div>
                        </div>
                </div>
        </div>
        <div id="footer">

        <div class="modal-footer">
                <p class="text-center">
                        Blog of <a href="/">dylan</a>.
                        Follow me on <a href="https://twitter.com/dylanninin" target="_blank">twitter</a>
                        or <a href="http://weibo.com/dylanninin" target="_blank">weibo</a>
                </p>
                <p class="text-center">
                        UI Designed by <a href="http://twitter.github.com/bootstrap" target="_blank">Twitter
                                Bootstrap</a>.
                        Powered by <a href="http://webpy.org" target="_blank">Web.py</a>.
                        Hosted by <a href="http://www.linode.com" target="_blank">Linode</a>.
                        Licensed under <a
                                href="http://creativecommons.org/licenses/by-nc-nd/3.0/" target="_blank">CC BY
                                3.0</a>
                </p>
                <p class="text-center">
                        Copyright &copy <a href="/">CLOUD</a> |
                        <a href="/about.html">About</a>
                </p>

        </div>
        <script src="/static/js/jquery.js"></script>
        <script src="/static/js/jquery-3.1.1.min.js"></script>
    <script src="/static/js/bootstrap.js"></script>
</div>

</body>
</html>
